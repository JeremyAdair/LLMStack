<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Python Toolbox README</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <main class="container">
      <header>
        <h1>Python Toolbox README</h1>
      </header>

      <section class="links">
        <a class="button" href="/docs.html">Back to Docs</a>
        <a class="button" href="/python-api.html">Back to Python API</a>
        <a class="button" href="/">Back to Landing</a>
      </section>

      <section class="note">
        <pre style="white-space: pre-wrap;"># Python toolbox

This directory provides a Dockerized Python toolbox for CLI scripts and an optional
FastAPI surface for job triggers from Node-RED or Flowise.

## Build and run

From the repo root:

```bash
docker compose -f compose/docker-compose.yml build python-toolbox
```

Start the toolbox container:

```bash
docker compose -f compose/docker-compose.yml up -d python-toolbox
```

Start the API container:

```bash
docker compose -f compose/docker-compose.yml up -d python-api
```

## API quick start

The API listens on port 8000.

- Docs: `http://localhost:8000/docs`
- OpenAPI: `http://localhost:8000/openapi.json`
- Health: `http://localhost:8000/health`

Example calls:

```bash
curl http://localhost:8000/health
curl -X POST http://localhost:8000/rag/ingest_once
curl -X POST http://localhost:8000/plc/poll_once
```

## Script locations

All scripts live under:

- `python-toolbox/app/scripts/`
  - `db_tools/` health checks and DB utilities
  - `rag_ingest/` ingestion helpers
  - `plc_poll/` PLC polling helpers
  - `custom/` (add your own)

The API code lives under:

- `python-toolbox/app/api/`
  - `app.py` (FastAPI app + router registration)
  - `routes_*.py` (endpoint definitions)

The repo `bin/` folder is mounted into the containers at `/host-bin` so the
web UI can show both the toolbox scripts and the repo scripts.

## Add or remove API scripts

To add a new script to the API:

1) Put your script or helper in `python-toolbox/app/scripts/&lt;your_area&gt;/`.
2) Add an endpoint in `python-toolbox/app/api/routes_&lt;your_area&gt;.py`.
3) Register the router in `python-toolbox/app/api/app.py`.

Example pattern:

```python
# python-toolbox/app/api/routes_jobs.py
from fastapi import APIRouter
from scripts.my_jobs.run_job import run_job

router = APIRouter(prefix=&quot;/jobs&quot;, tags=[&quot;jobs&quot;])

@router.post(&quot;/run&quot;)
def run() -&gt; dict:
    return run_job()
```

```python
# python-toolbox/app/api/app.py
from api.routes_jobs import router as jobs_router
app.include_router(jobs_router)
```

To remove an API script, remove the endpoint and its router import/registration.
Because the container bind-mounts `python-toolbox/app`, changes take effect on
restart of the `python-api` container.

## Scripts web UI

The API includes a lightweight web UI for listing, editing, uploading, and
running Python scripts:

- UI: `http://localhost:8000/ui`

Notes:

- Execution is only enabled for scripts under `python-toolbox/app/scripts/`.
- The `/host-bin` mount is for viewing and editing only.
- Use JSON array syntax in the UI to pass args (example: `[&quot;--flag&quot;, &quot;value&quot;]`).

## Exec into the toolbox and run scripts

```bash
docker compose -f compose/docker-compose.yml exec python-toolbox bash
```

Example script runs:

```bash
python /app/scripts/plc_poll/poll_plc.py
python /app/scripts/rag_ingest/ingest_folder.py
python /app/scripts/db_tools/healthcheck.py
```

## Environment variables

Common variables:

- `REDIS_URL` default: `redis://redis:6379/0`
- `DATABASE_URL` optional, for Postgres writes
- `QDRANT_URL` default: `http://qdrant:6333`
- `QDRANT_COLLECTION` default: `documents`

PLC polling:

- `PLC_IP` default: `127.0.0.1`
- `PLC_SLOT` default: `0`
- `PLC_TIMEOUT` default: `1.0`
- `POLL_INTERVAL_MS` default: `1000`
- `PLC_TAGSET_PATH` default: `/app/scripts/plc_poll/tagsets.example.yaml`

RAG ingestion:

- `INGEST_PATH` default: `/app/ingest`
- `EMBED_MODEL` default: `all-MiniLM-L6-v2`
- `INGEST_INTERVAL` default: `60` seconds

## Example compose usage

The repo-level compose file already includes the services. The key pieces are:

```yaml
python-toolbox:
  build:
    context: ../python-toolbox
    dockerfile: Dockerfile
  command: [&quot;sleep&quot;, &quot;infinity&quot;]
  volumes:
    - ../python-toolbox/app:/app
    - ../bin:/host-bin

python-api:
  image: llmstack/python-toolbox:local
  command: [&quot;uvicorn&quot;, &quot;api.app:app&quot;, &quot;--host&quot;, &quot;0.0.0.0&quot;, &quot;--port&quot;, &quot;8000&quot;]
  ports:
    - &quot;8000:8000&quot;
  volumes:
    - ../python-toolbox/app:/app
    - ../bin:/host-bin
```

## PLC polling best practices

- Run a single polling loop per PLC. Multiple pollers cause noisy data and extra load.
- Use Redis as a shared cache for current values.
- If you enable Postgres writes, ensure indexes match your query patterns.
</pre>
      </section>
    </main>
  </body>
</html>
